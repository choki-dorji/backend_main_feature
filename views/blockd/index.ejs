<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Bootstrap link -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

	<link href="https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css" rel="stylesheet" />

	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"
		integrity="sha384-HSZ7Ld1Gg5+8oWchX9zv5V5jLQQaQ8VwW5PD5D59pZa0TKOkuL8Jm9zvNSm7gJcu" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.bx.io/boxicons/4.0.0/css/boxicons.min.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

	<link rel="stylesheet" type="text/css" href="path/to/helvetica-font-file.ttf">

	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/search.css">
	<link rel="stylesheet" href="/css/block.css">
	<link rel="stylesheet" href="/css/phone_view.css">
    <script src="/js/index.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
	<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.6/dist/sweetalert2.min.css">
	
	<!-- ... other head elements ... -->
	<!-- ... body content ... -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.6/dist/sweetalert2.all.min.js"></script>

	<title>Hostel Allocation</title>
</head>

<body>
	<!-- MAIN -->
			<main id="block">
				<div class="row">
                    <% for(var i = 0; i < blocks.length; i++) { %>					
					<div class="col-lg-4 col-md-6 col-sm-12">
						<div class="shadow-box">
							<p class="status">Block status: <span clas="act" style="color:#ff4b13"><%= blocks[i].status %></span></p>
							<div class="block-details">
								<i class="material-icons icon"><%= blocks[i].type %></i>
								<h5 class="bname"><%= blocks[i].block_name %></h5>
								<!-- <i class="bx bx-edit edit-icon"></i> -->
								<!-- <i class="bx bx-trash trash-icon"></i> -->

                                <a  data-id=<%= blocks[i]._id%> >
                                    <span class="text-gradient"><i class="bx bx-edit edit-icon" id="edit-btn"></i></span>
                                </a>
                                <a class="delete" data-id=<%= blocks[i]._id%> >
                                    <span class="text-gradient"><i class="bx bx-trash trash-icon"></i></span>
                                </a>

							</div>
							<div class="room-details pt-4">
								<h5 class="room-number "><%= blocks[i].rooms.length %></h5>
								<span class="room-total">Rooms</span>
							</div>
							<div class="student-details pt-4">
								<h5 class="room-number">45</h5>
								<span class="tot mt-4">Students</span>
							</div>
							<button class="button mt-4 text-center">
								<p class="mt-2">View rooms</p>
							</button>
						</div>
					</div>
                    <% } %>
				</div>
            </main>
			
			<script>
				// Attach event listener to delete icon
$(".delete").click(function() {
    var id = $(this).attr("data-id");

    // Show confirmation message using SweetAlert2
    Swal.fire({
        title: "Are you sure?",
        text: "You won't be able to revert this!",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#ff4b13",
        cancelButtonColor: "#000",
        confirmButtonText: "Yes, delete it!",
        cancelButtonText: "Cancel"
    }).then((result) => {
        if (result.isConfirmed) {

            // Send AJAX request to delete block
            $.ajax({
                url: "/api/blocks/" + id,
                method: "DELETE",
                success: function(response) {
                    // If the block was successfully deleted, display a success message using Toastify and reload the page
                    Toastify({
                        text: "Block deleted successfully!",
                        backgroundColor: "linear-gradient(to right, #00b09b, #96c93d)",
                        className: "success",
                    }).showToast();
                    location.reload();
                },
                error: function(error) {
                    // If there was an error deleting the block, display an error message using Toastify
                    Toastify({
                        text: "Error deleting block: " + error.responseText,
                        backgroundColor: "linear-gradient(to right, #ff5f6d, #ffc371)",
                        className: "error",
                    }).showToast();
                }
            });
        }
    });
});
			
			</script>

	<!-- EDIT -->
	<script>
		// Attach event listener to edit icon
$(".edit-icon").click(function() {
    var id = $(this).parent().attr("data-id");

    // Show prompt to enter new block name using SweetAlert2
    Swal.fire({
        title: "Enter new block name:",
        html: '',
        inputValue: $(this).siblings(".bname").text(),
        showCancelButton: true,
        confirmButtonColor: "#ff4b13",
        cancelButtonColor: "#000",
        confirmButtonText: "OK",
        cancelButtonText: "Cancel",
	
    }).then((result) => {
        if (result.isConfirmed) {
            var newBlockName = result.value;

            // Send AJAX request to update block
            $.ajax({
                url: "/api/blocks/" + id,
                method: "PUT",
                data: { block_name: newBlockName },
                success: function(response) {
                    // If the block was successfully updated, display a success message using Toastify and reload the page
                    Toastify({
                        text: "Block updated successfully!",
                        backgroundColor: "linear-gradient(to right, #00b09b, #96c93d)",
                        className: "success",
                    }).showToast();
                    location.reload();
                },
                error: function(error) {
                    // If there was an error updating the block, display an error message using Toastify
                    Toastify({
                        text: "Error updating block: " + error.responseText,
                        backgroundColor: "linear-gradient(to right, #ff5f6d, #ffc371)",
                        className: "error",
                    }).showToast();
                }
            });
        }
    });
});
	</script>
	
	
</body>

</html>